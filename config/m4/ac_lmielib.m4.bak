# This looks for the LMIELIB libraries. If we find them, we set the Makefile
# conditional HAVE_LMIELIB. We as set LMIELIB_CPPFLAGS, and LMIELIB_LDFLAGS.
# 
# To allow users to build there own copy of LMIELIB, we also define
# BUILD_LMIELIB

AC_DEFUN([AC_LMIELIB],
[
have_lmielib="no"
build_lmielib="no"
AC_ARG_WITH([lmielib],
        AS_HELP_STRING([--with-lmielib@<:@=DIR@:>@], [use lmielib (default is yes if found) - it is possible to specify the root directory for lmielib (optional). You can also specify "build" if you want to build your own local copy. See also THIRDPARTY variable described below. This is only needed if you are building a local copy of boost.]),
        [
    if test "$withval" = "no"; then
        want_lmielib="no"
    elif test "$withval" = "yes"; then
        want_lmielib="yes"
        ac_lmielib_path=""
    elif test "$withval" = "build"; then
        want_lmielib="yes"
        build_lmielib="yes"
        if test "x$prefix" = xNONE; then
           ac_lmielib_path="$ac_default_prefix"
        else
           ac_lmielib_path="$prefix"
        fi
    else
        want_lmielib="yes"
        ac_lmielib_path="$withval"
    fi
    ],
    [
    want_lmielib="yes"
    if test "$THIRDPARTY" = "build"; then
        want_lmielib="yes"
        build_lmielib="yes"
        if test "x$prefix" = xNONE; then
           ac_lmielib_path="$ac_default_prefix"
        else
           ac_lmielib_path="$prefix"
        fi
    fi
    ])

if test "x$want_lmielib" = "xyes"; then
        AC_MSG_CHECKING([for LMIELIB library])
        succeeded=no
        if test "$ac_lmielib_path" != ""; then
            LMIELIB_LDFLAGS="-L$ac_lmielib_path/lib -Wl,-rpath -Wl,$ac_lmielib_path/lib"
            LMIELIB_CPPFLAGS="-I$ac_lmielib_path/include"
	    LMIELIB_TARGET="$ac_lmielib_path/include/lmie_interface.h"
            succeeded=yes
        else
            for ac_lmielib_path_tmp in $prefix $THIRDPARTY /groups/algorithm/commonlib/$commonlib_version/$compiler_name /usr /usr/local /opt /opt/local /sw ; do
                  if test -e "$ac_lmielib_path_tmp/include/lmie_interface.h" && test -r "$ac_lmielib_path_tmp/include/lmie_interface.h"; then
		      LMIELIB_LDFLAGS="-L$ac_lmielib_path_tmp/lib -Wl,-rpath -Wl,$ac_lmielib_path_tmp/lib"
                      LMIELIB_CPPFLAGS="-I$ac_lmielib_path_tmp/include"
      	              LMIELIB_TARGET="$ac_lmielib_path_tmp/include/lmie_interface.h"
                      succeeded=yes
                      break;
                  fi
            done
        fi

        if test "$succeeded" != "yes" ; then
                AC_MSG_RESULT([no])
        else
                AC_MSG_RESULT([yes])
                AC_SUBST(LMIELIB_CPPFLAGS)
                AC_SUBST(LMIELIB_TARGET)
                AC_SUBST(LMIELIB_LDFLAGS)
                AC_DEFINE(HAVE_LMIELIB,,[Defined if we have LMIELIB])
                have_lmielib="yes"
        fi
fi
AM_CONDITIONAL([HAVE_LMIELIB], [test "$have_lmielib" = "yes"])
AM_CONDITIONAL([BUILD_LMIELIB], [test "$build_lmielib" = "yes"])
])
